{% extends "base.html" %}

{% block content %}
    <div class="row">
        <h3>Update Alert Details</h3>
        <hr/>

        <form class="form-horizontal ajax-form" id="alert-detail" role="form" action="{{ action_url }}" data-method="{{ method }}">
            {% include 'fragments/form-input.html' with name="coin" label="Coin" type="select" choices=coin_choices %}
            {% include 'fragments/form-input.html' with name="currency" label="Currency" type="select" choices=currency_choices %}

            {% include 'fragments/form-input.html' with name="trigger_type" label="Trigger type" type="select" choices=constants.alert_trigger_types %}
            {% include 'fragments/form-input.html' with name="amount" label="Amount" type="number" %}
            {% include 'fragments/form-input.html' with name="evolution" label="Evolution" type="number" %}
            {% include 'fragments/form-input.html' with name="evolution_period" label="Evolution period" type="text" %}

            {% include 'fragments/form-input.html' with name="message_interval" label="Repeat alert" type="text" %}
            {% include 'fragments/form-input.html' with name="activated" label="Activated" value="true" type="checkbox" %}

            {% include 'fragments/form-button.html' with label="Save" %}

            <div class="form-group api-response"></div>
        </form>
    </div>

{% endblock %}

{% block script %}
    <script type="text/javascript">
        let app_context = {{ frontend_app_context|safe }};

        $(document).ready(function () {
            $(document).on('alertDataReceived', function(event, data) {
                $('select[name=coin]').val(data.coin).change();
                $('select[name=currency]').val(data.currency).change();
                $('select[name=trigger_type]').val(data.trigger_type).change();
                $('input[name=amount]').val(data.amount);
                $('input[name=evolution]').val(data.evolution);
                $('input[name=evolution_period]').val(data.evolution_period);
                $('input[name=message_interval]').val(data.message_interval);

                if (data.activated === true) {
                    $('input[name=activated]').prop('checked', true);
                } else {
                    $('input[name=activated]').prop('checked', false);
                }
            });

            let form = $('form#alert-detail');

            sendAjax(form.attr('action'), "GET", {}, "alertDataReceived");
        });
    </script>
{% endblock %}
